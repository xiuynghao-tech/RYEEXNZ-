--[[
    FISH IT SCRIPT - AirHub V2 Style
    Made for Fish It / Fishing Simulator
    Version: 1.0.0
    Telegram: t.me/Swill_Way
]]

-- Load Check
if FishItV2Loaded then return end
getgenv().FishItV2Loaded = true

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = Workspace.CurrentCamera

-- Load UI Library (AirHub Style)
local UI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Exunys/AirHub-V2/main/src/UI%20Library.lua"))()
local MainFrame = UI:Load("FISH IT SCRIPT v1.0.0")

-- Variables
local Settings = {
    AutoFishing = false,
    AutoCast = true,
    AutoReel = true,
    InstantCatch = false,
    FishESP = false,
    PlayerESP = false,
    ESPColor = Color3.fromRGB(0, 255, 255),
    ESPTransparency = 0.5,
    WalkSpeed = 16,
    JumpPower = 50,
    NoClip = false,
    AntiAFK = true,
    SelectedRod = "Auto",
    SelectedBait = "None"
}

local ESP_Highlights = {}
local ESP_Names = {}

-- =============================================
-- FUNGSI UTAMA
-- =============================================

-- Fungsi mendapatkan rod
local function getRod()
    if LocalPlayer.Character then
        for _, v in pairs(LocalPlayer.Character:GetChildren()) do
            if v:IsA("Tool") and (v.Name:lower():find("rod") or v.Name:lower():find("pole")) then
                return v
            end
        end
    end
    for _, v in pairs(LocalPlayer.Backpack:GetChildren()) do
        if v:IsA("Tool") and (v.Name:lower():find("rod") or v.Name:lower():find("pole")) then
            return v
        end
    end
    return nil
end

-- Fungsi cast
local function castLine()
    local rod = getRod()
    if rod then
        local castEvent = rod:FindFirstChild("Cast") or rod:FindFirstChild("Fish")
        if castEvent then
            castEvent:FireServer()
            return true
        end
    end
    return false
end

-- Fungsi reel
local function reelIn()
    local rod = getRod()
    if rod then
        local reelEvent = rod:FindFirstChild("Reel") or rod:FindFirstChild("Pull")
        if reelEvent then
            reelEvent:FireServer()
            return true
        end
    end
    return false
end

-- Auto Fishing Loop
local function startAutoFishing()
    spawn(function()
        while Settings.AutoFishing do
            wait(0.3)
            
            -- Equip rod
            local rod = getRod()
            if not rod or rod.Parent ~= LocalPlayer.Character then
                rod = getRod()
                if rod then
                    LocalPlayer.Character.Humanoid:EquipTool(rod)
                end
                wait(0.5)
            end
            
            if Settings.AutoCast then
                castLine()
                wait(1.5)
            end
            
            if Settings.AutoReel then
                reelIn()
                if Settings.InstantCatch then
                    wait(0.1)
                    reelIn()
                end
                wait(1)
            end
        end
    end)
end

-- Fungsi update ESP
local function updateESP()
    if Settings.FishESP then
        for _, v in pairs(Workspace:GetDescendants()) do
            if v:IsA("Model") and (v.Name:lower():find("fish") or v.Name:lower():find("salmon")) then
                if not v:FindFirstChild("FishESP") then
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "FishESP"
                    highlight.Parent = v
                    highlight.FillColor = Settings.ESPColor
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = Settings.ESPTransparency
                    table.insert(ESP_Highlights, highlight)
                end
            end
        end
    end
end

-- =============================================
-- TAB GENERAL (KIRI)
-- =============================================
local General, GeneralSignal = MainFrame:Tab("General")

-- Auto Fishing Section
local AutoFishSection = General:Section({
    Name = "Auto Fishing Settings",
    Side = "Left"
})

AutoFishSection:Toggle({
    Name = "Auto Fishing",
    Flag = "AutoFishing",
    Default = Settings.AutoFishing,
    Callback = function(Value)
        Settings.AutoFishing = Value
        if Value then
            startAutoFishing()
        end
    end
})

AutoFishSection:Toggle({
    Name = "Auto Cast",
    Flag = "AutoCast",
    Default = Settings.AutoCast,
    Callback = function(Value)
        Settings.AutoCast = Value
    end
})

AutoFishSection:Toggle({
    Name = "Auto Reel",
    Flag = "AutoReel",
    Default = Settings.AutoReel,
    Callback = function(Value)
        Settings.AutoReel = Value
    end
})

AutoFishSection:Toggle({
    Name = "Instant Catch",
    Flag = "InstantCatch",
    Default = Settings.InstantCatch,
    Callback = function(Value)
        Settings.InstantCatch = Value
    end
})

-- Equipment Section
local EquipmentSection = General:Section({
    Name = "Equipment",
    Side = "Left"
})

EquipmentSection:Dropdown({
    Name = "Select Rod",
    Flag = "SelectedRod",
    Content = {"Auto", "Basic Rod", "Fiberglass Rod", "Carbon Rod", "Titanium Rod"},
    Default = Settings.SelectedRod,
    Callback = function(Value)
        Settings.SelectedRod = Value
    end
})

EquipmentSection:Dropdown({
    Name = "Select Bait",
    Flag = "SelectedBait",
    Content = {"None", "Worm", "Minnow", "Shrimp", "Squid", "Golden Bait"},
    Default = Settings.SelectedBait,
    Callback = function(Value)
        Settings.SelectedBait = Value
    end
})

-- Manual Controls Section
local ManualSection = General:Section({
    Name = "Manual Controls",
    Side = "Left"
})

ManualSection:Button({
    Name = "Cast Line",
    Callback = function()
        castLine()
    end
})

ManualSection:Button({
    Name = "Reel In",
    Callback = function()
        reelIn()
    end
})

-- =============================================
-- TAB PLAYER (KANAN)
-- =============================================
local PlayerTab = MainFrame:Tab("Player")

-- Movement Section
local MovementSection = PlayerTab:Section({
    Name = "Movement",
    Side = "Left"
})

MovementSection:Slider({
    Name = "Walk Speed",
    Flag = "WalkSpeed",
    Default = Settings.WalkSpeed,
    Min = 16,
    Max = 250,
    Callback = function(Value)
        Settings.WalkSpeed = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = Value
        end
    end
})

MovementSection:Slider({
    Name = "Jump Power",
    Flag = "JumpPower",
    Default = Settings.JumpPower,
    Min = 50,
    Max = 250,
    Callback = function(Value)
        Settings.JumpPower = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = Value
        end
    end
})

MovementSection:Toggle({
    Name = "No Clip",
    Flag = "NoClip",
    Default = Settings.NoClip,
    Callback = function(Value)
        Settings.NoClip = Value
        if Value then
            RunService.Stepped:Connect(function()
                if Settings.NoClip and LocalPlayer.Character then
                    for _, v in pairs(LocalPlayer.Character:GetChildren()) do
                        if v:IsA("BasePart") then
                            v.CanCollide = false
                        end
                    end
                end
            end)
        end
    end
})

-- Stats Section
local StatsSection = PlayerTab:Section({
    Name = "Stats",
    Side = "Right"
})

StatsSection:Label("Player Name: " .. LocalPlayer.Name)
StatsSection:Label("User ID: " .. LocalPlayer.UserId)
StatsSection:Label("Account Age: " .. LocalPlayer.AccountAge .. " days")

-- =============================================
-- TAB ESP (KIRI & KANAN)
-- =============================================
local ESPTab = MainFrame:Tab("ESP")

-- Fish ESP Section
local FishESPSection = ESPTab:Section({
    Name = "Fish ESP",
    Side = "Left"
})

FishESPSection:Toggle({
    Name = "Fish ESP",
    Flag = "FishESP",
    Default = Settings.FishESP,
    Callback = function(Value)
        Settings.FishESP = Value
        if Value then
            spawn(function()
                while Settings.FishESP do
                    wait(1)
                    updateESP()
                end
            end)
        else
            for _, v in pairs(ESP_Highlights) do
                pcall(function() v:Destroy() end)
            end
            ESP_Highlights = {}
        end
    end
})

FishESPSection:Colorpicker({
    Name = "Fish ESP Color",
    Flag = "FishESPColor",
    Default = Settings.ESPColor,
    Callback = function(Value)
        Settings.ESPColor = Value
        for _, v in pairs(ESP_Highlights) do
            pcall(function() v.FillColor = Value end)
        end
    end
})

FishESPSection:Slider({
    Name = "Fish ESP Transparency",
    Flag = "FishESPTrans",
    Default = Settings.ESPTransparency * 10,
    Min = 1,
    Max = 10,
    Callback = function(Value)
        Settings.ESPTransparency = Value / 10
        for _, v in pairs(ESP_Highlights) do
            pcall(function() v.FillTransparency = Value / 10 end)
        end
    end
})

-- Player ESP Section
local PlayerESPSection = ESPTab:Section({
    Name = "Player ESP",
    Side = "Right"
})

PlayerESPSection:Toggle({
    Name = "Player ESP",
    Flag = "PlayerESP",
    Default = Settings.PlayerESP,
    Callback = function(Value)
        Settings.PlayerESP = Value
        if Value then
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    -- Highlight
                    local highlight = Instance.new("Highlight")
                    highlight.Parent = player.Character
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.5
                    
                    -- Name
                    if player.Character:FindFirstChild("Head") then
                        local billboard = Instance.new("BillboardGui")
                        local text = Instance.new("TextLabel")
                        
                        billboard.Parent = player.Character.Head
                        billboard.Size = UDim2.new(0, 100, 0, 30)
                        billboard.StudsOffset = Vector3.new(0, 2, 0)
                        billboard.AlwaysOnTop = true
                        
                        text.Parent = billboard
                        text.Size = UDim2.new(1, 0, 1, 0)
                        text.BackgroundTransparency = 1
                        text.Text = player.Name
                        text.TextColor3 = Color3.fromRGB(255, 255, 255)
                        text.TextStrokeTransparency = 0
                        text.TextSize = 14
                    end
                end
            end
        else
            -- Hapus semua ESP
        end
    end
})

-- =============================================
-- TAB MISC
-- =============================================
local MiscTab = MainFrame:Tab("Misc")

-- Server Section
local ServerSection = MiscTab:Section({
    Name = "Server",
    Side = "Left"
})

ServerSection:Button({
    Name = "Rejoin Game",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
    end
})

ServerSection:Button({
    Name = "Server Hop",
    Callback = function()
        local HttpService = game:GetService("HttpService")
        local success, result = pcall(function()
            return game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?limit=100")
        end)
        
        if success then
            local servers = HttpService:JSONDecode(result).data
            for _, server in pairs(servers) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, server.id, LocalPlayer)
                    break
                end
            end
        end
    end
})

-- Utility Section
local UtilitySection = MiscTab:Section({
    Name = "Utility",
    Side = "Right"
})

UtilitySection:Toggle({
    Name = "Anti AFK",
    Flag = "AntiAFK",
    Default = Settings.AntiAFK,
    Callback = function(Value)
        Settings.AntiAFK = Value
        if Value then
            LocalPlayer.Idled:Connect(function()
                VirtualUser:Button2Down(Vector2.new(0,0), Camera.CFrame)
                wait(1)
                VirtualUser:Button2Up(Vector2.new(0,0), Camera.CFrame)
            end)
        end
    end
})

UtilitySection:Button({
    Name = "Copy Telegram",
    Callback = function()
        setclipboard("t.me/Swill_Way")
    end
})

-- =============================================
-- TAB SETTINGS
-- =============================================
local SettingsTab = MainFrame:Tab("Settings")

-- UI Section
local UISection = SettingsTab:Section({
    Name = "UI Settings",
    Side = "Left"
})

UISection:Keybind({
    Name = "Toggle UI",
    Flag = "ToggleUI",
    Default = "F4",
    Callback = function(Keybind)
        -- Already handled by UI library
    end
})

UISection:Button({
    Name = "Destroy UI",
    Callback = function()
        MainFrame:Destroy()
    end
})

-- =============================================
-- AUTO ANTI AFK
-- =============================================
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), Camera.CFrame)
    wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), Camera.CFrame)
end)

-- =============================================
-- WATERMARK & NOTIFICATION
-- =============================================
print("âœ… FISH IT SCRIPT loaded successfully!")
print("ðŸ“± Telegram: t.me/Swill_Way")
print("ðŸŽ¯ Press F4 to toggle UI")
